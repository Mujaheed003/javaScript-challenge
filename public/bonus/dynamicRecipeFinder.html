<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic Recipe Finder</title>
    <!-- Poppins font for modern aesthetic -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      /* CSS Styling */
      :root {
        --primary-color: #e67e22; /* Vibrant Orange/Brown */
        --secondary-color: #34495e; /* Dark Blue/Grey */
        --background-light: #f4f7f6;
        --card-bg: #ffffff;
        --text-dark: #333;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        --transition-speed: 0.3s;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--background-light);
        color: var(--text-dark);
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Header and Search Area */
      .header {
        background-color: var(--secondary-color);
        color: var(--card-bg);
        padding: 40px 0;
        text-align: center;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 5px;
      }

      .header p {
        font-weight: 300;
        margin-bottom: 25px;
      }

      .search-area {
        display: flex;
        justify-content: center;
        gap: 10px;
        max-width: 600px;
        margin: 0 auto;
      }

      #search-input {
        flex-grow: 1;
        padding: 12px 15px;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color var(--transition-speed);
      }

      #search-input:focus {
        outline: none;
        border-color: var(--secondary-color);
      }

      .btn-search {
        background-color: var(--primary-color);
        color: var(--card-bg);
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color var(--transition-speed);
      }

      .btn-search:hover {
        background-color: #d35400;
      }

      /* Main Content & Results */
      .main-content {
        padding: 40px 0;
      }

      #message-box {
        text-align: center;
        padding: 20px;
        font-size: 1.1rem;
        color: var(--secondary-color);
        font-weight: 600;
      }

      /* Recipe Grid (Responsive) */
      #recipe-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
        margin-top: 30px;
      }

      .recipe-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: var(--shadow);
        overflow: hidden;
        cursor: pointer;
        transition: transform var(--transition-speed);
      }

      .recipe-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .recipe-img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        display: block;
      }

      .recipe-info {
        padding: 15px;
        text-align: center;
      }

      .recipe-info h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
        color: var(--secondary-color);
      }

      .btn-view {
        background-color: var(--primary-color);
        color: var(--card-bg);
        border: none;
        padding: 8px 15px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-top: 5px;
        transition: opacity var(--transition-speed);
      }

      .btn-view:hover {
        opacity: 0.9;
      }

      /* Recipe Modal/Lightbox */
      .recipe-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none; /* Hidden by default */
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .recipe-modal.show {
        display: flex;
        opacity: 1;
      }

      .modal-content {
        background-color: var(--card-bg);
        border-radius: 12px;
        max-width: 900px;
        max-height: 90vh;
        width: 90%;
        overflow-y: auto;
        position: relative;
        padding: 30px;
        box-shadow: var(--shadow);
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }

      .recipe-modal.show .modal-content {
        transform: scale(1);
      }

      .btn-close-modal {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--secondary-color);
        cursor: pointer;
        padding: 5px;
      }

      .modal-content h2 {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 15px;
        text-align: center;
      }

      .recipe-details {
        display: flex;
        gap: 20px;
      }

      .recipe-image-container {
        flex-shrink: 0;
        width: 40%;
        max-width: 300px;
      }

      .recipe-image-container img {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .recipe-instructions {
        flex-grow: 1;
      }

      .recipe-instructions h3,
      .ingredient-list h3 {
        font-size: 1.3rem;
        color: var(--secondary-color);
        border-bottom: 2px solid var(--background-light);
        padding-bottom: 5px;
        margin-bottom: 10px;
      }

      .ingredient-list ul {
        list-style: none;
        padding: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 5px;
      }

      .ingredient-list li {
        background-color: #ffe0b2; /* Light orange background */
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.95rem;
      }

      /* --- Responsiveness --- */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .search-area {
          flex-direction: column;
          padding: 0 10px;
        }

        .recipe-details {
          flex-direction: column; /* Stack image and details vertically */
        }

        .recipe-image-container {
          width: 100%;
          max-width: none;
        }

        .modal-content {
          padding: 20px;
          width: 95%;
        }
      }

      @media (max-width: 480px) {
        .header {
          padding: 25px 0;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .main-content {
          padding: 20px 0;
        }

        .btn-search {
          width: 100%;
        }

        .ingredient-list ul {
          grid-template-columns: 1fr; /* Single column ingredients on smallest screen */
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <h1><i class="fas fa-utensils"></i> Recipe Finder</h1>
        <p>Search for your favorite meals and discover new recipes!</p>
        <div class="search-area">
          <input
            type="text"
            id="search-input"
            placeholder="Search for ingredients or meal name..."
          />
          <button id="search-btn" class="btn-search">Find Recipes</button>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="container">
        <div id="message-box"></div>
        <div id="recipe-grid">
          <!-- Recipe cards will be injected here -->
        </div>
      </div>
    </main>

    <!-- Recipe Details Modal/Lightbox -->
    <div id="recipe-modal" class="recipe-modal">
      <div class="modal-content">
        <button
          class="btn-close-modal"
          id="close-modal-btn"
          aria-label="Close Recipe View"
        >
          <i class="fas fa-times"></i>
        </button>
        <div id="modal-details-content">
          <!-- Full recipe details will be injected here -->
        </div>
      </div>
    </div>

    <script>
      // -------------------------------------------------------------------
      // Global Constants and DOM Elements
      // -------------------------------------------------------------------
      const MEALDB_SEARCH_URL =
        "https://www.themealdb.com/api/json/v1/1/search.php?s=";
      const MEALDB_LOOKUP_URL =
        "https://www.themealdb.com/api/json/v1/1/lookup.php?i=";

      const searchInput = document.getElementById("search-input");
      const searchBtn = document.getElementById("search-btn");
      const recipeGrid = document.getElementById("recipe-grid");
      const messageBox = document.getElementById("message-box");
      const recipeModal = document.getElementById("recipe-modal");
      const modalDetailsContent = document.getElementById(
        "modal-details-content"
      );
      const closeModalBtn = document.getElementById("close-modal-btn");

      // -------------------------------------------------------------------
      // UI Helpers
      // -------------------------------------------------------------------

      /**
       * Displays a temporary message to the user (error, info, or no results).
       * @param {string} message The message content.
       */
      function showMessage(message) {
        messageBox.textContent = message;
        messageBox.style.display = "block";
      }

      /**
       * Clears the recipe grid and message box.
       */
      function clearResults() {
        recipeGrid.innerHTML = "";
        messageBox.textContent = "";
        messageBox.style.display = "none";
      }

      /**
       * Opens the modal and injects the recipe details.
       * @param {string} mealId The ID of the meal to look up.
       */
      async function openRecipeModal(mealId) {
        try {
          // Show a temporary loading message in the modal
          modalDetailsContent.innerHTML = `<h2 style="text-align:center;"><i class="fas fa-spinner fa-spin"></i> Loading...</h2>`;
          recipeModal.classList.add("show");
          document.body.style.overflow = "hidden"; // Disable body scroll

          const response = await fetch(MEALDB_LOOKUP_URL + mealId);
          if (!response.ok) throw new Error("Failed to fetch detailed recipe.");

          const data = await response.json();
          const meal = data.meals[0];

          if (meal) {
            renderModalDetails(meal);
          } else {
            modalDetailsContent.innerHTML = `<h2 style="color:var(--primary-color);">Details Not Found</h2><p>Could not retrieve full recipe instructions.</p>`;
          }
        } catch (error) {
          console.error("Error fetching recipe details:", error);
          modalDetailsContent.innerHTML = `<h2 style="color:var(--primary-color);">Error</h2><p>Failed to load recipe details. Please try again.</p>`;
        }
      }

      /**
       * Closes the recipe modal.
       */
      function closeRecipeModal() {
        recipeModal.classList.remove("show");
        document.body.style.overflow = "auto"; // Re-enable body scroll
      }

      // -------------------------------------------------------------------
      // Rendering Functions
      // -------------------------------------------------------------------

      /**
       * Renders the search results into the recipe grid.
       * @param {Array<object>} meals Array of meal objects from the API.
       */
      function renderRecipes(meals) {
        clearResults();
        if (!meals || meals.length === 0) {
          showMessage(
            "No recipes found. Try a different ingredient or meal name."
          );
          return;
        }

        meals.forEach((meal) => {
          const card = document.createElement("div");
          card.classList.add("recipe-card");
          card.setAttribute("data-id", meal.idMeal);

          card.innerHTML = `
                    <img src="${meal.strMealThumb}" alt="${
            meal.strMeal
          }" class="recipe-img">
                    <div class="recipe-info">
                        <h3>${meal.strMeal}</h3>
                        <p>${meal.strArea || ""} Dish</p>
                        <button class="btn-view" onclick="window.openRecipeModal('${
                          meal.idMeal
                        }')">View Recipe</button>
                    </div>
                `;
          recipeGrid.appendChild(card);
        });
      }

      /**
       * Renders the detailed view of a recipe inside the modal.
       * @param {object} meal The detailed meal object.
       */
      function renderModalDetails(meal) {
        // Collect ingredients and measures (TheMealDB provides 20 potential ingredient fields)
        const ingredients = [];
        for (let i = 1; i <= 20; i++) {
          const ingredient = meal[`strIngredient${i}`];
          const measure = meal[`strMeasure${i}`];
          if (ingredient && ingredient.trim() !== "") {
            ingredients.push(`<li>${measure || ""} ${ingredient}</li>`);
          }
        }

        // Cleanup instructions for display
        const instructions = meal.strInstructions.replace(/\r\n/g, "<br><br>");

        modalDetailsContent.innerHTML = `
                <h2>${meal.strMeal}</h2>
                <p style="text-align:center; color:var(--primary-color); font-style: italic;">Category: ${
                  meal.strCategory || "N/A"
                } | Origin: ${meal.strArea || "N/A"}</p>
                <hr style="margin: 15px 0; border-color: #f0f0f0;">

                <div class="recipe-details">
                    <div class="recipe-image-container">
                        <img src="${meal.strMealThumb}" alt="${meal.strMeal}">
                        ${
                          meal.strYoutube
                            ? `<a href="${meal.strYoutube}" target="_blank" style="display:block; text-align:center; color:white; background:red; padding:8px; border-radius:5px; text-decoration:none;"><i class="fab fa-youtube"></i> Watch Video</a>`
                            : ""
                        }
                    </div>
                    
                    <div class="recipe-instructions">
                        <div class="ingredient-list">
                            <h3>Ingredients</h3>
                            <ul>${ingredients.join("")}</ul>
                        </div>

                        <h3>Instructions</h3>
                        <p style="white-space: pre-wrap; margin-top:10px;">${instructions}</p>
                    </div>
                </div>
            `;
      }

      // -------------------------------------------------------------------
      // Main Search Logic
      // -------------------------------------------------------------------

      /**
       * Handles the main search operation.
       */
      async function handleSearch() {
        const query = searchInput.value.trim();
        if (query === "") {
          showMessage(
            "Please enter an ingredient or meal name to start your search."
          );
          return;
        }

        clearResults();
        showMessage(
          `<i class="fas fa-sync fa-spin"></i> Searching for recipes...`
        );

        try {
          const response = await fetch(MEALDB_SEARCH_URL + query);
          if (!response.ok) throw new Error("Network response was not ok");

          const data = await response.json();
          renderRecipes(data.meals);
        } catch (error) {
          console.error("Fetch error:", error);
          showMessage(
            `Sorry, there was an error connecting to the recipe database.`
          );
        }
      }

      // -------------------------------------------------------------------
      // Event Listeners and Initialization
      // -------------------------------------------------------------------

      // 1. Search button click
      searchBtn.addEventListener("click", handleSearch);

      // 2. Enter key press in the input field
      searchInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          handleSearch();
        }
      });

      // 3. Modal close button
      closeModalBtn.addEventListener("click", closeRecipeModal);

      // 4. Modal close by clicking outside the content
      recipeModal.addEventListener("click", (e) => {
        if (e.target === recipeModal) {
          closeRecipeModal();
        }
      });

      // 5. Expose function globally for onclick attribute inside dynamic HTML
      window.openRecipeModal = openRecipeModal;

      // Initial message on page load
      document.addEventListener("DOMContentLoaded", () => {
        showMessage(
          "Ready to discover your next meal! Try searching 'Chicken'."
        );
      });
    </script>
  </body>
</html>
