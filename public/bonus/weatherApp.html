<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Responsive Weather Dashboard (Local Data)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(
          135deg,
          #f0f9ff 0%,
          #e0f7fa 100%
        ); /* Soft gradient background */
        min-height: 100vh;
      }
      .dashboard-card {
        background-color: white;
        border-radius: 1rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease;
      }
      .dashboard-card:hover {
        transform: translateY(-2px);
      }
      .gradient-bg {
        background: linear-gradient(
          135deg,
          #1d4ed8 0%,
          #3b82f6 100%
        ); /* Deep Blue Gradient */
      }
      .loading-ring {
        width: 40px;
        height: 40px;
        border: 4px solid #fff;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="p-4 sm:p-8">
    <div class="max-w-6xl mx-auto">
      <header class="text-center mb-8">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800">
          Advanced Weather Dashboard
        </h1>
        <p class="text-gray-600 mt-2">
          Data is locally simulated and generated for full chart functionality.
        </p>
      </header>

      <!-- Search Input -->
      <div class="dashboard-card p-4 sm:p-6 mb-8">
        <div class="flex flex-col sm:flex-row gap-4">
          <input
            type="text"
            id="locationInput"
            placeholder="Enter city (e.g., Paris, Sydney, Dubai)"
            value="minna"
            class="flex-grow p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-indigo-200 transition duration-150 text-gray-700"
          />
          <button
            id="fetchWeatherBtn"
            class="px-6 py-3 gradient-bg text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-[1.01] active:scale-[0.99] flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                clip-rule="evenodd"
              />
            </svg>
            Simulate Weather
          </button>
        </div>
      </div>

      <!-- Status Message (Loading/Error) -->
      <div
        id="statusMessage"
        class="hidden text-center p-8 mb-8 dashboard-card"
      >
        <div class="flex flex-col items-center justify-center">
          <div class="loading-ring mb-4 bg-indigo-600"></div>
          <span class="text-xl font-semibold text-indigo-700"
            >Generating forecast...</span
          >
        </div>
      </div>

      <!-- Dashboard Content Grid -->
      <div
        id="dashboardContent"
        class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6"
      >
        <!-- Current Conditions Card (Large Section) -->
        <div
          class="dashboard-card p-6 lg:col-span-2 text-white gradient-bg relative overflow-hidden"
        >
          <div
            id="weatherIcon"
            class="absolute top-0 right-0 p-6 text-7xl opacity-50"
          >
            ‚òÄÔ∏è
          </div>
          <h2 class="text-3xl font-bold mb-4 flex items-center">
            Current Conditions for
            <span id="currentLocationDisplay" class="ml-2"></span>
          </h2>

          <div class="flex items-end justify-between">
            <div>
              <div
                id="currentTempDisplay"
                class="text-8xl font-extrabold flex items-start"
              >
                <!-- Temperature will be injected here -->
              </div>
              <div
                id="currentConditionDisplay"
                class="mt-1 text-3xl font-semibold"
              >
                <!-- Condition text will be injected here -->
              </div>
            </div>
          </div>

          <div id="currentDescription" class="mt-4 text-lg font-light">
            <!-- Textual description from API will be injected here -->
          </div>
        </div>

        <!-- Forecast Text Card (Small Section) -->
        <div class="dashboard-card p-6 lg:col-span-1">
          <h2 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 mr-2 text-indigo-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            7-Day Highs & Lows
          </h2>
          <div id="forecastSummaryList" class="text-gray-600 space-y-3">
            <!-- Forecast highlights will be injected here -->
          </div>
        </div>

        <!-- Charts Section (Full Width) -->
        <div class="dashboard-card p-6 lg:col-span-3">
          <h2 class="text-2xl font-bold text-gray-700 mb-6 flex items-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 mr-2 text-blue-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 21h18"
              />
            </svg>
            Detailed 7-Day Forecast
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Temperature Chart -->
            <div>
              <h3 class="text-lg font-semibold text-gray-600 mb-2">
                Temperature ($^\circ C$)
              </h3>
              <div class="relative h-64">
                <canvas id="tempChart"></canvas>
              </div>
            </div>

            <!-- Precipitation Chart -->
            <div>
              <h3 class="text-lg font-semibold text-gray-600 mb-2">
                Rain Probability $(\%)$
              </h3>
              <div class="relative h-64">
                <canvas id="precipChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- Core Application Logic ---

      // DOM Elements
      const locationInput = document.getElementById("locationInput");
      const fetchWeatherBtn = document.getElementById("fetchWeatherBtn");
      const statusMessage = document.getElementById("statusMessage");
      const dashboardContent = document.getElementById("dashboardContent");
      const currentLocationDisplay = document.getElementById(
        "currentLocationDisplay"
      );
      const currentTempDisplay = document.getElementById("currentTempDisplay");
      const currentConditionDisplay = document.getElementById(
        "currentConditionDisplay"
      );
      const currentDescription = document.getElementById("currentDescription");
      const forecastSummaryList = document.getElementById(
        "forecastSummaryList"
      );
      const weatherIcon = document.getElementById("weatherIcon");

      // Chart instances
      let tempChartInstance = null;
      let precipChartInstance = null;

      // --- Helper Functions ---

      /**
       * Maps weather conditions to appropriate emojis.
       */
      const getWeatherIcon = (condition) => {
        const c = condition.toLowerCase();
        if (c.includes("sun") || c.includes("clear")) return "‚òÄÔ∏è";
        if (c.includes("cloudy") || c.includes("overcast")) return "‚òÅÔ∏è";
        if (c.includes("rain") || c.includes("shower")) return "üåßÔ∏è";
        if (c.includes("storm") || c.includes("thunder")) return "‚õàÔ∏è";
        if (c.includes("snow") || c.includes("flurry")) return "‚ùÑÔ∏è";
        if (c.includes("fog") || c.includes("mist")) return "üå´Ô∏è";
        return "üå°Ô∏è"; // Default
      };

      /**
       * Generates realistic, structured mock weather data internally.
       * This function replaces the external API call.
       */
      const generateLocalWeather = async (location) => {
        // Simulate a short processing delay
        await new Promise((resolve) => setTimeout(resolve, 500));

        const conditions = [
          "Sunny",
          "Partly Cloudy",
          "Light Rain",
          "Thunderstorms",
          "Clear Sky",
        ];
        const descriptions = [
          `A dynamic forecast for ${location} shows stable weather with a slight chance of evening showers. Enjoy the calm, seasonal temperatures typical for this time of year.`,
          `Expect rapidly changing conditions in ${location} over the next 24 hours, transitioning from clear mornings to cloudy afternoons. The pressure system suggests mild instability.`,
          `The week ahead in ${location} is dominated by a persistent high-pressure system, ensuring sunny and dry days. Temperatures will gradually climb, peaking mid-week.`,
        ];

        // Simple heuristic for base temperature
        let baseTemp = 20;
        const loc = location.toLowerCase();
        if (
          loc.includes("dubai") ||
          loc.includes("miami") ||
          loc.includes("sydney")
        )
          baseTemp = 28;
        else if (
          loc.includes("london") ||
          loc.includes("tokyo") ||
          loc.includes("paris")
        )
          baseTemp = 18;
        else if (loc.includes("moscow") || loc.includes("anchorage"))
          baseTemp = 5;

        const currentCondition =
          conditions[Math.floor(Math.random() * conditions.length)];
        const currentTemp = baseTemp + Math.floor(Math.random() * 5 - 2);

        const forecast = [];
        for (let i = 0; i < 7; i++) {
          const date = new Date();
          date.setDate(date.getDate() + i);
          const day = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][
            date.getDay()
          ];

          // Simulate high/low variance
          const high_c = currentTemp + 2 + Math.floor(Math.random() * 5 - 2);
          const low_c = currentTemp - 5 + Math.floor(Math.random() * 4 - 2);

          // Simulate precipitation chance (more likely on cloudy/rainy days)
          let pop_percent = Math.floor(Math.random() * 50);
          if (
            currentCondition.includes("Rain") ||
            currentCondition.includes("Storm")
          ) {
            pop_percent = Math.floor(Math.random() * 50) + 50; // Higher chance
          }

          forecast.push({
            day,
            high_c: Math.round(high_c),
            low_c: Math.round(low_c),
            pop_percent,
          });
        }

        return {
          current_city: location,
          current_conditions: currentCondition,
          current_temp_c: currentTemp,
          current_description:
            descriptions[Math.floor(Math.random() * descriptions.length)],
          forecast: forecast,
        };
      };

      /**
       * Renders or updates the two Chart.js graphs.
       */
      const renderCharts = (forecastData) => {
        const labels = forecastData.map((d) => d.day);
        const highTemps = forecastData.map((d) => d.high_c);
        const lowTemps = forecastData.map((d) => d.low_c);
        const precipitation = forecastData.map((d) => d.pop_percent);

        // --- Temperature Chart ---
        const tempCtx = document.getElementById("tempChart").getContext("2d");
        if (tempChartInstance) {
          tempChartInstance.destroy();
        }

        tempChartInstance = new Chart(tempCtx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "High Temp (¬∞C)",
                data: highTemps,
                borderColor: "#1e40af", // Blue-800
                backgroundColor: "rgba(30, 64, 175, 0.1)",
                pointRadius: 6,
                pointHoverRadius: 8,
                fill: false,
                tension: 0.4,
              },
              {
                label: "Low Temp (¬∞C)",
                data: lowTemps,
                borderColor: "#059669", // Emerald-600
                backgroundColor: "rgba(5, 150, 105, 0.1)",
                pointRadius: 6,
                pointHoverRadius: 8,
                fill: false,
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: true, position: "top" } },
            scales: {
              y: {
                title: { display: true, text: "Temperature (¬∞C)" },
                grid: { color: "rgba(0,0,0,0.05)" },
              },
              x: {
                title: { display: true, text: "Day" },
                grid: { display: false },
              },
            },
          },
        });

        // --- Precipitation Chart ---
        const precipCtx = document
          .getElementById("precipChart")
          .getContext("2d");
        if (precipChartInstance) {
          precipChartInstance.destroy();
        }

        precipChartInstance = new Chart(precipCtx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Chance of Rain (%)",
                data: precipitation,
                backgroundColor: "#4f46e5", // Indigo-600
                borderColor: "#3730a3",
                borderWidth: 1,
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: "Probability (%)" },
                grid: { color: "rgba(0,0,0,0.05)" },
              },
              x: {
                title: { display: true, text: "Day" },
                grid: { display: false },
              },
            },
          },
        });
      };

      /**
       * Updates the UI elements after a successful mock data fetch.
       */
      const updateUI = (data) => {
        // 1. Stop loading and show content
        statusMessage.classList.add("hidden");
        dashboardContent.classList.remove("hidden");

        // 2. Populate Current Weather Card
        currentLocationDisplay.textContent = data.current_city.toUpperCase();
        weatherIcon.textContent = getWeatherIcon(data.current_conditions);

        currentTempDisplay.innerHTML = `${data.current_temp_c}<span class="text-4xl align-top">&deg;C</span>`;
        currentConditionDisplay.textContent = data.current_conditions;
        currentDescription.textContent = data.current_description;

        // 3. Populate Forecast Summary Card (List of highs/lows)
        forecastSummaryList.innerHTML = data.forecast
          .map(
            (f) => `
                <div class="flex justify-between items-center text-gray-700 border-b border-gray-100 pb-2">
                    <span class="font-semibold">${f.day}</span>
                    <span class="text-sm">High: ${f.high_c}¬∞C / Low: ${f.low_c}¬∞C</span>
                </div>
            `
          )
          .join("");

        // 4. Render Charts
        renderCharts(data.forecast);
      };

      // --- Event Listeners and Initial Load ---

      const handleSearch = async () => {
        const location = locationInput.value.trim();
        if (location) {
          // Show loading state
          dashboardContent.classList.add("hidden");
          statusMessage.classList.remove("hidden");
          statusMessage.innerHTML =
            '<div class="flex flex-col items-center justify-center"><div class="loading-ring mb-4 bg-indigo-600"></div><span class="text-xl font-semibold text-indigo-700">Generating local simulation...</span></div>';

          const weatherData = await generateLocalWeather(location);
          updateUI(weatherData);
        } else {
          statusMessage.innerHTML =
            '<span class="text-xl font-semibold text-red-600">Please enter a location.</span>';
          statusMessage.classList.remove("hidden");
          dashboardContent.classList.add("hidden");
        }
      };

      fetchWeatherBtn.addEventListener("click", handleSearch);
      locationInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          handleSearch();
        }
      });

      // Load data for the default city on startup
      document.addEventListener("DOMContentLoaded", handleSearch);
    </script>
  </body>
</html>
