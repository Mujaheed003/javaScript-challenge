<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Preview Uploader</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Set default font to Inter for clean aesthetics */
      body {
        font-family: "Inter", sans-serif;
        background-color: #f7f7f7;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      /* Custom scrollbar for preview area */
      #preview-container::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      #preview-container::-webkit-scrollbar-thumb {
        background-color: #9ca3af; /* gray-400 */
        border-radius: 4px;
      }
      #preview-container::-webkit-scrollbar-track {
        background-color: #e5e7eb; /* gray-200 */
      }
    </style>
  </head>
  <body class="p-4 sm:p-8">
    <!-- Main Application Card -->
    <div
      class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 sm:p-10 border border-gray-100"
    >
      <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 mb-2">
        Instant File Preview
      </h1>
      <p class="text-gray-500 mb-8">
        Select an image, video, or text file to see a real-time preview.
      </p>

      <!-- Hidden File Input -->
      <input
        type="file"
        id="fileInput"
        class="hidden"
        accept="image/*, video/*, text/*"
      />

      <!-- Upload Interface -->
      <div
        class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-8"
      >
        <button
          id="uploadButton"
          class="w-full sm:w-auto px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.99]"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 inline-block mr-2"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L6.707 6.707a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
          Choose File to Preview
        </button>

        <div
          id="fileInfo"
          class="text-sm text-gray-600 truncate max-w-full sm:max-w-xs"
        >
          No file selected.
        </div>
      </div>

      <!-- Preview Area -->
      <div
        id="preview-container"
        class="min-h-[200px] max-h-[60vh] overflow-auto border-2 border-dashed border-gray-300 bg-gray-50 rounded-lg p-4 transition-all duration-300 flex justify-center items-center text-center text-gray-400 italic"
      >
        Your file preview will appear here.
      </div>
    </div>

    <script>
      // Use a single global object to hold state and DOM elements
      const app = {
        fileInput: document.getElementById("fileInput"),
        uploadButton: document.getElementById("uploadButton"),
        previewContainer: document.getElementById("preview-container"),
        fileInfo: document.getElementById("fileInfo"),
      };

      const MAX_TEXT_FILE_SIZE_MB = 0.5; // Max 500KB for text preview to prevent slowdowns

      // Helper to display messages or clear the preview
      const setPreviewMessage = (message, isError = false) => {
        app.previewContainer.innerHTML = `<div class="${
          isError ? "text-red-500 font-bold" : "text-gray-500 italic"
        } p-4">${message}</div>`;
        app.previewContainer.classList.add(
          "flex",
          "justify-center",
          "items-center",
          "text-center"
        );
        app.previewContainer.classList.remove("p-0");
      };

      // Reads the selected file and determines how to display the preview
      const handleFileChange = () => {
        const file = app.fileInput.files[0];

        if (!file) {
          app.fileInfo.textContent = "No file selected.";
          setPreviewMessage("Your file preview will appear here.");
          return;
        }

        // Update file information display
        app.fileInfo.textContent = `${file.name} (${(
          file.size /
          1024 /
          1024
        ).toFixed(2)} MB)`;

        // Clear previous preview
        app.previewContainer.innerHTML = "";
        app.previewContainer.classList.remove("p-0");

        const reader = new FileReader();

        // --- Image/Video Preview ---
        if (file.type.startsWith("image/") || file.type.startsWith("video/")) {
          reader.onload = (e) => {
            const mediaElement = document.createElement(
              file.type.startsWith("image/") ? "img" : "video"
            );
            mediaElement.src = e.target.result;
            mediaElement.className =
              "w-full h-auto object-contain max-h-[60vh] rounded-lg shadow-lg";
            mediaElement.setAttribute(
              "controls",
              file.type.startsWith("video/")
            );
            mediaElement.setAttribute("alt", `Preview of ${file.name}`);

            app.previewContainer.innerHTML = ""; // Clear message
            app.previewContainer.classList.remove(
              "flex",
              "justify-center",
              "items-center",
              "text-center"
            );
            app.previewContainer.classList.add("p-0");
            app.previewContainer.appendChild(mediaElement);
          };
          reader.readAsDataURL(file);
          return;
        }

        // --- Text File Preview ---
        if (file.type.startsWith("text/")) {
          // Check for file size limit for text
          if (file.size > MAX_TEXT_FILE_SIZE_MB * 1024 * 1024) {
            setPreviewMessage(
              `Text file is too large for preview. Max allowed: ${MAX_TEXT_FILE_SIZE_MB} MB.`,
              true
            );
            return;
          }

          reader.onload = (e) => {
            const textContent = e.target.result;
            const pre = document.createElement("pre");
            pre.className =
              "whitespace-pre-wrap break-words text-sm text-gray-700 bg-white p-4 rounded-lg overflow-x-auto";
            pre.textContent = textContent.substring(0, 10000); // Limit display length

            app.previewContainer.innerHTML = ""; // Clear message
            app.previewContainer.classList.remove(
              "flex",
              "justify-center",
              "items-center",
              "text-center"
            );
            app.previewContainer.classList.add("p-4");
            app.previewContainer.appendChild(pre);

            if (textContent.length > 10000) {
              const truncationNote = document.createElement("p");
              truncationNote.className = "text-xs text-red-500 mt-2";
              truncationNote.textContent =
                "(... Preview truncated for display purposes. File content is longer.)";
              app.previewContainer.appendChild(truncationNote);
            }
          };
          // Read text files as simple text
          reader.readAsText(file);
          return;
        }

        // --- Generic File Info (for unsupported types) ---
        setPreviewMessage(
          `
                <p class="font-bold">File Type Not Supported for Visual Preview:</p>
                <p>Name: ${file.name}</p>
                <p>Type: ${file.type || "Unknown"}</p>
                <p>Size: ${(file.size / 1024).toFixed(2)} KB</p>
                <p class="mt-2">Please select an image, video, or text file.</p>
            `,
          true
        );
      };

      // Event Listeners
      app.uploadButton.addEventListener("click", () => {
        // Programmatically click the hidden file input
        app.fileInput.click();
      });

      app.fileInput.addEventListener("change", handleFileChange);

      // Initial setup message
      setPreviewMessage("Your file preview will appear here.");
    </script>
  </body>
</html>
